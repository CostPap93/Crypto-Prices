<!DOCTYPE html>
<html>
<head>
    <script src='javascript/Chart.js'></script>

    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <style>
    body{background-color:white;font-family: verdana;
    height: 100%;
}
    /* h1{font-size: 48px;text-transform: uppercase;letter-spacing: 2px;text-align: center;} */
    /* p{font-size: 16px;text-align: center;} */
    /* table{margin-left: auto;margin-right: auto;text-align: center;} */
    /* input{
     background:none!important;
     color:inherit;
     border:none;
     padding:0!important;
     font: inherit;
     
    border-bottom:1px solid #444;
     cursor: pointer;
}   */
h1{
  color:black;
  padding-left:50px;
}
ul{
	list-style:none;
	padding:0;
	margin: 0 0 10px 0;

}
li.crypto{
  text-transform: capitalize;
	display:inline;
	margin-right:10px;
}
li.month{
	display:inline;
	margin-right:10px;
}
li.year{
  display:inline;
  padding-right:10px;
  margin-right:10px;
  border-right: 4px solid ;
}table.data{
    width:80%;
  border : 2px solid;
}div.charts{
    padding-bottom:150px;
    padding-left:50px;
}



  </style>
</head>
<body>


    <nav class="navbar navbar-inverse">
        <div class="container-fluid">
          <div class="navbar-header">
            <a class="navbar-brand" href="./">Cryptocurrency Prices</a>
          </div>
          <ul class="nav navbar-nav">
            <li ><a href="./">Home</a></li>
            <li><a href="/crypto">Prices</a></li>
          </ul>
        </div>
      </nav>
    

    <h1>Data for <%=crypto%></h1>

    <div class='charts'>
        <div class='col' style="display:inline-block;height:7vh; width:15vw">
            <canvas id='highcanvas' width='5' height='5'></canvas>
            </div>
            <div class='col' style="display:inline-block;height:7vh; width:15vw">
            <canvas id='opencanvas' width='10' height='10'></canvas>
            </div>
            <div class='col' style="display:inline-block;height:7vh; width:15vw">
            <canvas id='lowcanvas' width='10' height='10'></canvas>
            </div>
            <div class='col' style="display:inline-block;height:7vh; width:15vw">
            <canvas id='closecanvas' width='10' height='10'></canvas>
            </div>
            <div class='col' style="display:inline-block;height:7vh; width:15vw">
            <canvas id='volumecanvas' width='10' height='10'></canvas>
            </div>
            <div class='col' style="display:inline-block;height:7vh; width:15vw">
            <canvas id='capcanvas' width='10' height='10'></canvas>
            </div>
    
            </div>


    <div>
            <table align='center' class="table table-bordered data">
            <thead class="thead-dark">
              <tr>
                <th >Date</th>
                <th >Open</th>
                <th >High</th>
                <th >Low</th>
                <th >Close</th>
                <th >Volume</th>
                <th >Market Cap</th>
              </tr>
            </thead>
            <tbody>
            <% data.forEach(function(item){%>
              <tr>
                <td ><%if(item.date.getDate()<10){%>
                    <%='0'+ item.date.getDate() +'/'+ item.date.getMonth()%>
                    <%}else{%>
                    <%=item.date.getDate() +'/'+ item.date.getMonth()%>
                    <%}%>

                </td>
                <td ><%=item.open%></td>
                <td><%=item.high%></td>
                <td><%=item.low%></td>
                <td><%=item.close%></td>
                <td><%=item.volume%></td>
                <td><%=item.marketcap%></td>
          
              </tr>
          
              <%});%>
            </tbody>
          </div>


    </table>

    <script src='javascript/sort.js'></script>

    <div class='aggregation'>
    <div>
        <table class='table table-responsive'>
        <tr class='active'>
          <th class='text-center col-sm-1'>Μέγιστο</th>
          <th class='max btn btn-link col-sm-1' name='open'>open</th>
          <th class='max btn btn-link col-sm-1' name='high'>high</th>
          <th class='max btn btn-link col-sm-1' name='low'>low</th>
          <th class='max btn btn-link col-sm-1' name='close'>close</th>
          <th class='max btn btn-link col-sm-1' name='volume'>volume</th>
          <th class='max btn btn-link col-sm-1' name='marketcap'>marketcap</th>
        </tr>
          </table>
        </div>
      
        <%if(agg='max' && max!=''){%>
          <%max.forEach(function(it){%>
      <h4 class='text-center'><%=it.max%></h4>
          <%})%>
        <%}%>
      
        <div>
          <table class='table table-responsive'>
          <tr class='active'>
            <th class='text-center col-sm-1'>Ελάχιστο</th>
            <th class='min btn btn-link col-sm-1' name='open'>open</th>
            <th class='min btn btn-link col-sm-1' name='high'>high</th>
            <th class='min btn btn-link col-sm-1' name='low'>low</th>
            <th class='min btn btn-link col-sm-1' name='close'>close</th>
            <th class='min btn btn-link col-sm-1' name='volume'>volume</th>
            <th class='min btn btn-link col-sm-1' name='marketcap'>marketcap</th>
          </tr>
            </table>
          </div>
      
          <%if(agg='min' && max!=''){%>
            <%max.forEach(function(it){%>
        <h4 class='text-center'><%=it.min%></h4>
            <%})%>
          <%}%>
      
      
      
          <div>
            <table class='table table-responsive'>
            <tr class='active'>
              <th class='text-center col-sm-1'>Μέσο</th>
              <th class='avg btn btn-link col-sm-1' name='open' >open</th>
              <th class='avg btn btn-link col-sm-1' name='high'>high</th>
              <th class='avg btn btn-link col-sm-1' name='low'>low</th>
              <th class='avg btn btn-link col-sm-1' name='close'>close</th>
              <th class='avg btn btn-link col-sm-1' name='volume'>volume</th>
              <th class='avg btn btn-link col-sm-1' name='marketcap'>marketcap</th>
            </tr>
              </table>
            </div>
      
            <%if(agg='avg' && max!='') {%>
              <%max.forEach(function(it){%>
          <h4 class='text-center'><%=it.avg%></h4>
              <%})%>
            <%}%>

              </div>

              <script>
              $(".max").click(function(){
    var column=$(this).attr('name');
    var aggre =$(this).attr('class').match(/max+/)[0];
    console.log(aggre);
    $.post("http://localhost:5000/aggre",{column:column,aggre:aggre},function(data){
        if(data==='done')
        {
            window.location.href="/dates";
        }
    });

  // $.ajax({
  //   type: "POST",
  //   data: {crypto:crypto,cryptos:cryptos},
  //   url: "months",
  //   success: function(msg){
  //     console.log(cryptos);
  //     window.location.href="/months";
  //   }
  // });
});
$(".min").click(function(){
    var column=$(this).attr('name');
    var aggre =$(this).attr('class').match(/min+/)[0];
    console.log(aggre);
    $.post("http://localhost:5000/aggre",{column:column,aggre:aggre},function(data){
        if(data==='done')
        {
            window.location.href="/dates";
        }
    });

  // $.ajax({
  //   type: "POST",
  //   data: {crypto:crypto,cryptos:cryptos},
  //   url: "months",
  //   success: function(msg){
  //     console.log(cryptos);
  //     window.location.href="/months";
  //   }
  // });
});

$(".avg").click(function(){
    var column=$(this).attr('name');
    var aggre =$(this).attr('class').match(/avg+/)[0];
    console.log(aggre);
    $.post("http://localhost:5000/aggre",{column:column,aggre:aggre},function(data){
        if(data==='done')
        {
            window.location.href="/dates";
        }
    });

  // $.ajax({
  //   type: "POST",
  //   data: {crypto:crypto,cryptos:cryptos},
  //   url: "months",
  //   success: function(msg){
  //     console.log(cryptos);
  //     window.location.href="/months";
  //   }
  // });
});
              </script>


        <script>
        
        var highchrt = document.getElementById('highcanvas').getContext('2d');
        var openchrt = document.getElementById('opencanvas').getContext('2d');
        var lowchrt = document.getElementById('lowcanvas').getContext('2d');
        var closechrt = document.getElementById('closecanvas').getContext('2d');
        var volumechrt = document.getElementById('volumecanvas').getContext('2d');
        var capchrt = document.getElementById('capcanvas').getContext('2d');
        
        var dates= [];
        var highs= [];
        var opens= [];
        var lows= [];
        var closes =[];
        var volumes =[];
        var caps =[];
        <% data.forEach(function(index){%>
          dates.push('<%=index.date.getDate()%>');
          highs.push('<%= index.high%>');
          opens.push('<%= index.open%>');
          lows.push('<%= index.low%>');
          closes.push('<%= index.close%>');
          volumes.push('<%= index.volume%>');
          caps.push('<%= index.marketcap%>');
        
          <%}) ;%>
        
          var HighCanvas = new Chart(highchrt,{
              type: 'line',
              data: {
              labels: dates,
              datasets: [{
                  label: 'High',
                  data: highs,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.2)',
                      'rgba(54, 162, 235, 0.2)',
                      'rgba(255, 206, 86, 0.2)',
                      'rgba(75, 192, 192, 0.2)',
                      'rgba(153, 102, 255, 0.2)',
                      'rgba(255, 159, 64, 0.2)'
                  ],
                  borderColor: [
                      'rgba(255,99,132,1)',
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)',
                      'rgba(255, 159, 64, 1)'
                  ],
                  borderWidth: 1
              }]
            },
              options: {
                  scales: {
                      yAxes: [{
                          stacked: true
                      }]
                  }
              }
          });
        
        
        
          var OpenCanvas = new Chart(openchrt,{
              type: 'line',
              data: {
              labels: dates,
              datasets: [{
                  label: 'Open',
                  data: opens,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.2)',
                      'rgba(54, 162, 235, 0.2)',
                      'rgba(255, 206, 86, 0.2)',
                      'rgba(75, 192, 192, 0.2)',
                      'rgba(153, 102, 255, 0.2)',
                      'rgba(255, 159, 64, 0.2)'
                  ],
                  borderColor: [
                      'rgba(255,99,132,1)',
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)',
                      'rgba(255, 159, 64, 1)'
                  ],
                  borderWidth: 1
              }]
            },
              options: {
                  scales: {
                      yAxes: [{
                          stacked: true
                      }]
                  }
              }
          });
          var LowCanvas = new Chart(lowchrt,{
              type: 'line',
              data: {
              labels: dates,
              datasets: [{
                  label: 'Low',
                  data: lows,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.2)',
                      'rgba(54, 162, 235, 0.2)',
                      'rgba(255, 206, 86, 0.2)',
                      'rgba(75, 192, 192, 0.2)',
                      'rgba(153, 102, 255, 0.2)',
                      'rgba(255, 159, 64, 0.2)'
                  ],
                  borderColor: [
                      'rgba(255,99,132,1)',
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)',
                      'rgba(255, 159, 64, 1)'
                  ],
                  borderWidth: 1
              }]
            },
              options: {
                  scales: {
                      yAxes: [{
                          stacked: true
                      }]
                  }
              }
          });
          var CloseCanvas = new Chart(closechrt,{
              type: 'line',
              data: {
              labels: dates,
              datasets: [{
                  label: 'Close',
                  data: closes,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.2)',
                      'rgba(54, 162, 235, 0.2)',
                      'rgba(255, 206, 86, 0.2)',
                      'rgba(75, 192, 192, 0.2)',
                      'rgba(153, 102, 255, 0.2)',
                      'rgba(255, 159, 64, 0.2)'
                  ],
                  borderColor: [
                      'rgba(255,99,132,1)',
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)',
                      'rgba(255, 159, 64, 1)'
                  ],
                  borderWidth: 1
              }]
            },
              options: {
                  scales: {
                      yAxes: [{
                          stacked: true
                      }]
                  }
              }
          });
          var VolumeCanvas = new Chart(volumechrt,{
              type: 'line',
              data: {
              labels: dates,
              datasets: [{
                  label: 'Volume',
                  data: volumes,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.2)',
                      'rgba(54, 162, 235, 0.2)',
                      'rgba(255, 206, 86, 0.2)',
                      'rgba(75, 192, 192, 0.2)',
                      'rgba(153, 102, 255, 0.2)',
                      'rgba(255, 159, 64, 0.2)'
                  ],
                  borderColor: [
                      'rgba(255,99,132,1)',
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)',
                      'rgba(255, 159, 64, 1)'
                  ],
                  borderWidth: 1
              }]
            },
              options: {
                  scales: {
                      yAxes: [{
                          stacked: true
                      }]
                  }
              }
          });
          var CapCanvas = new Chart(capchrt,{
              type: 'line',
              data: {
              labels: dates,
              datasets: [{
                  label: 'Market Cap',
                  data: caps,
                  backgroundColor: [
                      'rgba(255, 99, 132, 0.2)',
                      'rgba(54, 162, 235, 0.2)',
                      'rgba(255, 206, 86, 0.2)',
                      'rgba(75, 192, 192, 0.2)',
                      'rgba(153, 102, 255, 0.2)',
                      'rgba(255, 159, 64, 0.2)'
                  ],
                  borderColor: [
                      'rgba(255,99,132,1)',
                      'rgba(54, 162, 235, 1)',
                      'rgba(255, 206, 86, 1)',
                      'rgba(75, 192, 192, 1)',
                      'rgba(153, 102, 255, 1)',
                      'rgba(255, 159, 64, 1)'
                  ],
                  borderWidth: 1
              }]
            },
              options: {
                  scales: {
                      yAxes: [{
                          stacked: true
                      }]
                  }
              }
          });
                
          </script>
        
</body>
</html>
